#!/bin/sh

aws_userarns(){
  aws iam list-users --output json --profile $1 | jq -r .Users[].Arn
}

# aws completion for bash
complete -C '/usr/local/bin/aws_completer' aws

# Set default AWS profile
awsprofile() {
  export AWS_DEFAULT_PROFILE=$1
}

# easily switches aws profiles on the fly
awsconfigure() {
  accounts=~/.aws/credentials
  #[[ ${accounts} ]] || accounts=~/.aws/credentials
  
  profiles=($(awk '/\[/{ gsub(/\[|\]/,"") ; print $NF }' $accounts))

  [[ -z "$1" ]] && printf \
      "%s\n" \
      "About: awsconfigure, version 1.0.0-2016 by Andrew Kuttor" \
      "Usage: awsconfigure [profile-name]" \
      "`echo -e "\n\e[4mAvailable Profiles\e[0m\n"`" \
      "${profiles[@]}" && 
      return

  [[ ( -v "$1" && "${profiles[@]}" =~ "$1" ) ]] && \
      export AWS_DEFAULT_PROFILE=$1;
      printf "%s\n" "`echo -e "\n\e[4mActivated Credential\e[0m"`";
      aws configure list | awk 'NR>2{print $1 ": " $2}';
} # end awsconfigure

# cf template validation
cfvalidate() {
  file_path=$1
  aws cloudformation validate-template \
      --template-body file:///$file_path
}
