#!/usr/bin/env zsh
# -*- coding: utf-8 -*-
# vim:set ft=zsh ts=2 sw=2 sts=0 foldmethod=marke

# Set Options
setopt AUTO_CD                    # Navigate without typing cd
setopt CHASE_LINKS                # Resolve links to their location
setopt HASH_CMDS                  # Dont search for commands
setopt HASH_LIST_ALL              # More accurate correction
setopt INTERACTIVE_COMMENTS       # Allow comments in readlin
setopt LIST_ROWS_FIRST            # Rows are way better
setopt LIST_TYPES                 # Append type chars to files
setopt MULTIOS                    # Write to multiple descriptors
setopt PROMPT_SUBST               # Enable param and arithmetic substitution
setopt RC_QUOTES                  # Allow 'Henry''s Garage'
setopt SHORT_LOOPS                # Sooo lazy: for x in y do cmd
setopt SUN_KEYBOARD_HACK          # Ignore rogue backquote
setopt BANG_HIST                  # Treat '!' char specially during expansion.
setopt EXTENDED_HISTORY           # Use history ":start:elapsed;command" format.
setopt HIST_EXPIRE_DUPS_FIRST     # Remove dupes first when trimming history.
setopt HIST_IGNORE_SPACE          # Don't record starting with a space.
setopt HIST_REDUCE_BLANKS         # Remove superfluous blanks before recording.
setopt HIST_SAVE_NO_DUPS          # Don't write dupes in the history file.
setopt HIST_VERIFY                # Don't execute immediately upon expansion.
setopt INC_APPEND_HISTORY         # Write to the history file immediately.
setopt SHARE_HISTORY              # Share history between all sessions.
unsetopt FLOW_CONTROL             # Disable /stop characters editor

# Folders
export DOTFILES=$HOME/.dotfiles
export CACHE="$HOME/.cache"
export CONFIG="$HOME/.config"

# Zsh-Autosuggest
export ZSH_AUTOSUGGEST_USE_ASYNC=1
export ZSH_AUTOSUGGEST_MANUAL_REBIND=1
export ZSH_AUTOSUGGEST_BUFFER_MAX_SIZE=1

# Terminal
export REPORTTIME=2
export TIMEFMT="%U user %S system %P cpu %*Es total"
export KEYTIMEOUT=1
export ITERM_24BIT=1
export WORDCHARS='*?-[]~\!#%^(){}<>|`@#%^*()+:?'
export OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES

# Editor
export EDITOR="$(which nvim)"
export VISUAL="$EDITOR"

# Pager
export PAGER="$(which bat)"
export MANPAGER="sh -c 'col -bx | bat -l man -p'"
export BAT_CONFIG_PATH="$DOTFILES/bat.conf"
# Ruby
export LDFLAGS="-L/usr/local/opt/ruby/lib"
export CPPFLAGS="-I/usr/local/opt/ruby/include"
export PKG_CONFIG_PATH="/usr/local/opt/ruby/lib/pkgconfig"

# FZF
export FZF_BASE=$(which fzf)

# Zlua
[[ ! -f "$CACHE/z.cache" ]] && touch "$CACHE/z.cache"
export _ZL_DATA="$CACHE/z.cache"
export _ZL_MATCH_MODE=1
export _ZL_HYPHEN=1
export _ZL_ECHO=1

# FZ
export FZ_HISTORY_CD_CMD="_zlua"
#source $(brew --prefix)/Cellar/fzf/0.21.1/bin/fzf

# -----------------------------------------------------------------------------
# History
# -----------------------------------------------------------------------------

exportHISTFILE=$CACHE/.zsh_history
exportHISTIGNORE="ls:cd:cd -:pwd:exit:date:* --help"
exportHISTSIZE=10000
exportSAVEHIST=10000

# Add timestamps
case $HIST_STAMPS in
  "mm/dd/yyyy") alias history='fc -fl 1' ;;
  "dd.mm.yyyy") alias history='fc -El 1' ;;
  "yyyy-mm-dd") alias history='fc -il 1' ;;
  *) alias history='fc -l 1' ;;
esac

# -----------------------------------------------------------------------------
# Paths
# -----------------------------------------------------------------------------

# Automatically remove duplicates from these arrays
typeset -U path PATH cdpath CDPATH fpath FPATH manpath MANPATH

# Function Paths
fpath=(
  #/usr/share/zsh-completions
  $DOTFILES/functions
  $fpath
)

autoload $DOTFILES/functions/*

# System Paths
path=(
  $(brew --prefix)/{sbin,bin}
  #$USER/Library/Python/{2.7,3.7}/{lib/python/site-packages,bin)}
  /usr/local/opt/ruby/bin
  /usr/local/opt/coreutils/libexec/gnubin
  /usr/local/{bin,sbin}(N-/)
  $USER/.local/bin
  /usr/{bin,sbin}(N-/)
  /{bin,sbin}(N-/)
  $path
)
